/**\n * Advanced Analytics Dashboard - Tableau de bord analytique d√©taill√©\n * M√©triques, tendances, insights, et rapports personnalis√©s\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  BarChart,\n  LineChart,\n  PieChart,\n  TrendingUp,\n  Download,\n  Share2,\n  RefreshCw,\n  Fire,\n  Target,\n  Users,\n  Clock,\n  Zap,\n  Award,\n} from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface AnalyticsSummary {\n  totalHours: number;\n  sessionCount: number;\n  favoriteArtist: string;\n  favoriteMood: string;\n  streakDays: number;\n  engagementScore: number;\n}\n\ninterface TopArtist {\n  name: string;\n  playCount: number;\n  percentage: number;\n}\n\ninterface Insight {\n  type: 'trend' | 'pattern' | 'recommendation' | 'milestone' | 'warning';\n  title: string;\n  description: string;\n  value?: string | number;\n  severity: 'info' | 'success' | 'warning' | 'critical';\n}\n\ninterface AdvancedAnalyticsDashboardProps {\n  userId?: string;\n  onReportGenerated?: (reportId: string) => void;\n  onExportClick?: (format: 'json' | 'csv' | 'pdf') => void;\n}\n\nexport const AdvancedAnalyticsDashboard: React.FC<AdvancedAnalyticsDashboardProps> = ({\n  userId = 'user-123',\n  onReportGenerated,\n  onExportClick,\n}) => {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState<'overview' | 'trends' | 'insights' | 'reports'>('overview');\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [summary, setSummary] = useState<AnalyticsSummary>({\n    totalHours: 124,\n    sessionCount: 42,\n    favoriteArtist: 'Ludovico Einaudi',\n    favoriteMood: 'Calm',\n    streakDays: 7,\n    engagementScore: 78,\n  });\n  const [topArtists, setTopArtists] = useState<TopArtist[]>([\n    { name: 'Ludovico Einaudi', playCount: 145, percentage: 25 },\n    { name: '√ìlafur Arnalds', playCount: 98, percentage: 17 },\n    { name: 'Yuki Kajiura', playCount: 76, percentage: 13 },\n    { name: 'Max Richter', playCount: 64, percentage: 11 },\n    { name: 'Tycho', playCount: 52, percentage: 9 },\n  ]);\n  const [insights, setInsights] = useState<Insight[]>([\n    {\n      type: 'milestone',\n      title: 'üî• 7-Day Streak!',\n      description: \"You've been listening for 7 consecutive days. Amazing dedication!\",\n      value: '7 days',\n      severity: 'success',\n    },\n    {\n      type: 'trend',\n      title: 'üìà High Engagement',\n      description: 'Your engagement score is 78%, indicating strong consistent usage.',\n      value: '78%',\n      severity: 'success',\n    },\n    {\n      type: 'pattern',\n      title: '‚è∞ Peak Time',\n      description: 'You listen most between 9-10 PM. Perfect time for reminders!',\n      value: '9-10 PM',\n      severity: 'info',\n    },\n    {\n      type: 'recommendation',\n      title: 'üí° Diversify Artists',\n      description: 'Consider exploring new artists. You have a favorite, but variety helps!',\n      value: '',\n      severity: 'warning',\n    },\n  ]);\n  const [hourlyData, setHourlyData] = useState<Array<{ hour: number; minutes: number }>>(\n    Array.from({ length: 24 }, (_, i) => ({\n      hour: i,\n      minutes: Math.floor(Math.random() * 120) + 10,\n    }))\n  );\n  const [weeklyData, setWeeklyData] = useState<Array<{ week: number; hours: number }>>(\n    Array.from({ length: 12 }, (_, i) => ({\n      week: i + 1,\n      hours: Math.floor(Math.random() * 15) + 5,\n    }))\n  );\n  const [moodDistribution, setMoodDistribution] = useState<Record<string, number>>({\n    Calm: 35,\n    Energetic: 25,\n    Happy: 20,\n    Focused: 15,\n    Other: 5,\n  });\n\n  const generateReport = async () => {\n    setIsGenerating(true);\n\n    try {\n      toast({\n        title: 'üìä Generating report...',\n        description: 'Analyzing your listening data',\n      });\n\n      // Simulate report generation\n      await new Promise((resolve) => setTimeout(resolve, 2000));\n\n      const reportId = `report_${Date.now()}`;\n      toast({\n        title: '‚úÖ Report generated!',\n        description: 'Your analytics report is ready',\n      });\n\n      onReportGenerated?.(reportId);\n    } catch (error) {\n      toast({\n        title: '‚ùå Failed to generate report',\n        description: 'Please try again',\n        variant: 'destructive',\n      });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const exportData = async (format: 'json' | 'csv' | 'pdf') => {\n    try {\n      toast({\n        title: `üì• Exporting as ${format.toUpperCase()}...`,\n        description: 'Preparing your data',\n      });\n\n      // Simulate export\n      await new Promise((resolve) => setTimeout(resolve, 1000));\n\n      const data = {\n        userId,\n        exportDate: new Date().toISOString(),\n        summary,\n        topArtists,\n        insights,\n      };\n\n      if (format === 'json') {\n        const element = document.createElement('a');\n        element.setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(data, null, 2)));\n        element.setAttribute('download', `analytics-${Date.now()}.json`);\n        element.style.display = 'none';\n        document.body.appendChild(element);\n        element.click();\n        document.body.removeChild(element);\n      } else if (format === 'csv') {\n        const csv = `Metric,Value\\nTotal Hours,${summary.totalHours}\\nSessions,${summary.sessionCount}\\nFavorite Artist,${summary.favoriteArtist}\\nStreak Days,${summary.streakDays}\\nEngagement Score,${summary.engagementScore}%`;\n        const element = document.createElement('a');\n        element.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv));\n        element.setAttribute('download', `analytics-${Date.now()}.csv`);\n        element.style.display = 'none';\n        document.body.appendChild(element);\n        element.click();\n        document.body.removeChild(element);\n      }\n\n      toast({\n        title: '‚úÖ Export complete!',\n        description: `File downloaded as ${format.toUpperCase()}`,\n      });\n\n      onExportClick?.(format);\n    } catch (error) {\n      toast({\n        title: '‚ùå Export failed',\n        description: 'Please try again',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case 'success':\n        return 'bg-green-500/10 border-green-500/20 text-green-700';\n      case 'warning':\n        return 'bg-yellow-500/10 border-yellow-500/20 text-yellow-700';\n      case 'critical':\n        return 'bg-red-500/10 border-red-500/20 text-red-700';\n      default:\n        return 'bg-blue-500/10 border-blue-500/20 text-blue-700';\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <h2 className=\"text-3xl font-bold text-foreground flex items-center gap-2\">\n            <BarChart className=\"h-8 w-8\" />\n            Advanced Analytics\n          </h2>\n          <p className=\"text-muted-foreground\">\n            Detailed insights into your listening habits and engagement\n          </p>\n        </div>\n\n        {/* Quick Actions */}\n        <div className=\"flex flex-wrap gap-2\">\n          <Button\n            onClick={generateReport}\n            disabled={isGenerating}\n            className=\"gap-2\"\n            variant=\"outline\"\n          >\n            {isGenerating ? (\n              <>\n                <motion.div animate={{ rotate: 360 }} transition={{ duration: 1, repeat: Infinity }}>\n                  <RefreshCw className=\"h-4 w-4\" />\n                </motion.div>\n                Generating...\n              </>\n            ) : (\n              <>\n                <Award className=\"h-4 w-4\" />\n                Generate Report\n              </>\n            )}\n          </Button>\n          <Button\n            onClick={() => exportData('json')}\n            className=\"gap-2\"\n            variant=\"outline\"\n          >\n            <Download className=\"h-4 w-4\" />\n            JSON\n          </Button>\n          <Button\n            onClick={() => exportData('csv')}\n            className=\"gap-2\"\n            variant=\"outline\"\n          >\n            <Download className=\"h-4 w-4\" />\n            CSV\n          </Button>\n          <Button\n            onClick={() => {\n              toast({\n                title: 'üì§ Share Feature',\n                description: 'Copy link to share your music stats',\n              });\n            }}\n            className=\"gap-2\"\n            variant=\"outline\"\n          >\n            <Share2 className=\"h-4 w-4\" />\n            Share\n          </Button>\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3\">\n        <Card>\n          <CardContent className=\"p-4 text-center space-y-2\">\n            <Clock className=\"h-5 w-5 mx-auto text-blue-500\" />\n            <p className=\"text-sm text-muted-foreground\">Total Hours</p>\n            <p className=\"text-2xl font-bold\">{summary.totalHours}</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 text-center space-y-2\">\n            <TrendingUp className=\"h-5 w-5 mx-auto text-green-500\" />\n            <p className=\"text-sm text-muted-foreground\">Sessions</p>\n            <p className=\"text-2xl font-bold\">{summary.sessionCount}</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 text-center space-y-2\">\n            <Fire className=\"h-5 w-5 mx-auto text-red-500\" />\n            <p className=\"text-sm text-muted-foreground\">Streak</p>\n            <p className=\"text-2xl font-bold\">{summary.streakDays}d</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 text-center space-y-2\">\n            <Zap className=\"h-5 w-5 mx-auto text-yellow-500\" />\n            <p className=\"text-sm text-muted-foreground\">Engagement</p>\n            <p className=\"text-2xl font-bold\">{summary.engagementScore}%</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 text-center space-y-2\">\n            <Users className=\"h-5 w-5 mx-auto text-purple-500\" />\n            <p className=\"text-sm text-muted-foreground\">Top Artist</p>\n            <p className=\"text-xs font-bold truncate\">{summary.favoriteArtist}</p>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 text-center space-y-2\">\n            <Target className=\"h-5 w-5 mx-auto text-pink-500\" />\n            <p className=\"text-sm text-muted-foreground\">Mood</p>\n            <p className=\"text-xs font-bold\">{summary.favoriteMood}</p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"flex gap-2 border-b\">\n        {['overview', 'trends', 'insights', 'reports'].map((tab) => (\n          <button\n            key={tab}\n            onClick={() => setActiveTab(tab as any)}\n            className={`px-4 py-2 text-sm font-medium transition-colors ${\n              activeTab === tab\n                ? 'text-accent border-b-2 border-accent'\n                : 'text-muted-foreground hover:text-foreground'\n            }`}\n          >\n            {tab.charAt(0).toUpperCase() + tab.slice(1)}\n          </button>\n        ))}\n      </div>\n\n      {/* Overview Tab */}\n      <AnimatePresence>\n        {activeTab === 'overview' && (\n          <motion.div\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: 10 }}\n            className=\"space-y-6\"\n          >\n            {/* Top Artists */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">üé§ Top Artists</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {topArtists.map((artist, idx) => (\n                    <div key={idx} className=\"space-y-1\">\n                      <div className=\"flex justify-between items-center text-sm\">\n                        <span className=\"font-medium\">{artist.name}</span>\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          {artist.percentage}%\n                        </Badge>\n                      </div>\n                      <div className=\"w-full bg-muted rounded-full h-2 overflow-hidden\">\n                        <motion.div\n                          className=\"bg-accent h-full\"\n                          initial={{ width: 0 }}\n                          animate={{ width: `${artist.percentage * 3.3}%` }}\n                          transition={{ duration: 0.6, delay: idx * 0.1 }}\n                        />\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Mood Distribution */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">üòä Mood Distribution</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-2 md:grid-cols-5 gap-3\">\n                  {Object.entries(moodDistribution).map(([mood, percentage]) => (\n                    <div key={mood} className=\"text-center p-3 rounded-lg bg-muted/30 border\">\n                      <p className=\"text-sm font-medium\">{mood}</p>\n                      <p className=\"text-2xl font-bold text-accent\">{percentage}%</p>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Trends Tab */}\n      <AnimatePresence>\n        {activeTab === 'trends' && (\n          <motion.div\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: 10 }}\n            className=\"space-y-6\"\n          >\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">‚è∞ Listening by Hour</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-6 gap-2 text-center\">\n                  {hourlyData.map((data) => (\n                    <div key={data.hour} className=\"space-y-2\">\n                      <div className=\"relative h-20 bg-muted rounded-lg overflow-hidden\">\n                        <motion.div\n                          className=\"w-full bg-gradient-to-t from-accent to-accent/50 absolute bottom-0\"\n                          initial={{ height: 0 }}\n                          animate={{ height: `${(data.minutes / 120) * 100}%` }}\n                          transition={{ duration: 0.6, delay: (data.hour % 6) * 0.05 }}\n                        />\n                      </div>\n                      <p className=\"text-xs font-medium text-muted-foreground\">{data.hour}</p>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">üìà Weekly Trend</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex items-end justify-between gap-2 h-40 p-4 bg-muted/20 rounded-lg\">\n                  {weeklyData.map((data, idx) => (\n                    <div\n                      key={idx}\n                      className=\"flex-1 flex flex-col items-center gap-2\"\n                    >\n                      <motion.div\n                        className=\"w-full bg-gradient-to-t from-accent to-accent/50 rounded\"\n                        initial={{ height: 0 }}\n                        animate={{ height: `${(data.hours / 15) * 140}px` }}\n                        transition={{ duration: 0.6, delay: idx * 0.05 }}\n                      />\n                      <p className=\"text-xs text-muted-foreground\">W{data.week}</p>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Insights Tab */}\n      <AnimatePresence>\n        {activeTab === 'insights' && (\n          <motion.div\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: 10 }}\n            className=\"space-y-4\"\n          >\n            {insights.map((insight, idx) => (\n              <motion.div\n                key={idx}\n                initial={{ opacity: 0, x: -10 }}\n                animate={{ opacity: 1, x: 0 }}\n                transition={{ delay: idx * 0.1 }}\n              >\n                <Card className={getSeverityColor(insight.severity)}>\n                  <CardContent className=\"p-4 space-y-2\">\n                    <div className=\"flex justify-between items-start gap-3\">\n                      <div className=\"flex-1\">\n                        <p className=\"font-semibold\">{insight.title}</p>\n                        <p className=\"text-sm opacity-80\">{insight.description}</p>\n                      </div>\n                      {insight.value && (\n                        <Badge variant=\"secondary\" className=\"text-xs font-bold\">\n                          {insight.value}\n                        </Badge>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              </motion.div>\n            ))}\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Reports Tab */}\n      <AnimatePresence>\n        {activeTab === 'reports' && (\n          <motion.div\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: 10 }}\n          >\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">üìã Generated Reports</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {[\n                  { id: '1', date: '2024-01-15', period: 'Weekly', format: 'JSON' },\n                  { id: '2', date: '2024-01-08', period: 'Weekly', format: 'CSV' },\n                  { id: '3', date: '2024-01-01', period: 'Monthly', format: 'JSON' },\n                ].map((report) => (\n                  <div\n                    key={report.id}\n                    className=\"flex items-center justify-between p-3 rounded-lg bg-muted/30 border\"\n                  >\n                    <div>\n                      <p className=\"font-medium text-sm\">\n                        {report.period} Report - {report.date}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">Format: {report.format}</p>\n                    </div>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      className=\"gap-1\"\n                      onClick={() => toast({ title: 'üì• Downloading...' })}\n                    >\n                      <Download className=\"h-3 w-3\" />\n                      Download\n                    </Button>\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};\n\nexport default AdvancedAnalyticsDashboard;
