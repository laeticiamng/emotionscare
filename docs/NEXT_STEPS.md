# üöÄ Prochaines √âtapes - D√©ploiement Production

> **Guide des actions imm√©diates pour d√©ployer EmotionsCare en production**

---

## üìã CHECKLIST PR√â-D√âPLOIEMENT

### ‚úÖ Phase 1 : Configuration Environnement (30 min)

#### 1.1 Variables d'environnement

```bash
# Cr√©er .env.production
cp .env.example .env.production
```

**Variables requises** :

```env
# === SUPABASE (OBLIGATOIRE) ===
VITE_SUPABASE_URL=https://yaincoxihiqdksxgrsrk.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# === APIs IA (OPTIONNEL) ===
# Hume AI (analyse √©motionnelle)
VITE_HUME_API_KEY=votre-cl√©-hume

# OpenAI (coach IA)
VITE_OPENAI_API_KEY=sk-proj-...

# Suno (musique th√©rapeutique)
VITE_SUNO_API_KEY=votre-cl√©-suno

# === ANALYTICS (OPTIONNEL) ===
VITE_SENTRY_DSN=https://...@sentry.io/...
VITE_GA_TRACKING_ID=G-...

# === SECRETS SUPABASE (EDGE FUNCTIONS) ===
# √Ä configurer dans Supabase Dashboard > Settings > Functions
```

**‚ö†Ô∏è Action** : 
1. Aller sur [Supabase Dashboard](https://supabase.com/dashboard/project/yaincoxihiqdksxgrsrk/settings/functions)
2. Ajouter les secrets suivants :
   - `OPENAI_API_KEY`
   - `HUME_API_KEY`
   - `SUNO_API_KEY`

---

#### 1.2 Configuration Supabase

**Base de donn√©es** :

```bash
# 1. V√©rifier les migrations
cd database/sql
ls -la *.sql

# 2. Les migrations sont d√©j√† appliqu√©es automatiquement par Supabase
# V√©rifier sur : https://supabase.com/dashboard/project/yaincoxihiqdksxgrsrk/editor
```

**RLS Policies** :

‚úÖ D√©j√† configur√©es (100% couverture)

**V√©rification** :
- Tables : `profiles`, `journal_voice`, `journal_text`, `vr_nebula_sessions`, `vr_dome_sessions`, `breath_weekly`, `assessments`
- Policies : `SELECT`, `INSERT`, `UPDATE`, `DELETE` par utilisateur

**‚ö†Ô∏è Action** : V√©rifier sur [Supabase Dashboard](https://supabase.com/dashboard/project/yaincoxihiqdksxgrsrk/database/tables)

---

#### 1.3 Authentification

**Providers activ√©s** :

```
‚úÖ Email/Password
‚úÖ Magic Link
‚ö†Ô∏è Google OAuth (√† activer si besoin)
‚ö†Ô∏è Apple OAuth (√† activer si besoin)
```

**‚ö†Ô∏è Action** :
1. Aller sur [Auth Providers](https://supabase.com/dashboard/project/yaincoxihiqdksxgrsrk/auth/providers)
2. Activer Google OAuth :
   - Client ID : `votre-client-id.apps.googleusercontent.com`
   - Client Secret : `GOCSPX-...`
3. Activer Apple OAuth (optionnel)

---

### ‚úÖ Phase 2 : Tests Finaux (15 min)

#### 2.1 Tests E2E

```bash
# Lancer tous les tests
npm run test:e2e

# V√©rifier que les 46 tests passent ‚úÖ
```

**R√©sultat attendu** :
```
‚úÖ journal-flow.e2e.ts : 11/11 tests
‚úÖ vr-flow.e2e.ts : 9/9 tests
‚úÖ breath-flow.e2e.ts : 8/8 tests
‚úÖ assessment-flow.e2e.ts : 9/9 tests
‚úÖ dashboard-loading.e2e.ts : 9/9 tests

Total : 46/46 tests ‚úÖ
```

---

#### 2.2 Linting & Type-checking

```bash
# ESLint
npm run lint
# ‚úÖ 0 erreurs attendues

# TypeScript
npm run type-check
# ‚úÖ 0 erreurs attendues

# Prettier
npm run format:check
# ‚úÖ Tous les fichiers format√©s
```

---

#### 2.3 Build Production

```bash
# Build optimis√©
npm run build

# V√©rifier la taille du bundle
ls -lh dist/assets/*.js
# ‚úÖ Taille < 500kB (gzipped)

# Preview du build
npm run preview
```

**M√©triques attendues** :
- FCP : < 1.8s ‚úÖ
- LCP : < 2.5s ‚úÖ
- CLS : < 0.1 ‚úÖ
- Bundle size : Optimis√© ‚úÖ

---

### ‚úÖ Phase 3 : D√©ploiement (20 min)

#### Option A : Vercel (RECOMMAND√â)

**Avantages** :
- ‚úÖ Edge Functions natif
- ‚úÖ Analytics inclus
- ‚úÖ Preview deployments automatiques
- ‚úÖ SSL automatique

**D√©ploiement** :

```bash
# 1. Installer Vercel CLI
npm i -g vercel

# 2. Login
vercel login

# 3. D√©ployer
vercel --prod

# 4. Configurer les variables d'environnement
# Sur : https://vercel.com/votre-org/emotionscare/settings/environment-variables
```

**Variables √† ajouter sur Vercel** :
```
VITE_SUPABASE_URL
VITE_SUPABASE_ANON_KEY
VITE_HUME_API_KEY (optionnel)
VITE_OPENAI_API_KEY (optionnel)
VITE_SUNO_API_KEY (optionnel)
```

**‚ö†Ô∏è Action** : 
1. Aller sur [Vercel Dashboard](https://vercel.com/)
2. Import project depuis GitHub
3. Configurer les env variables
4. Deploy

---

#### Option B : Netlify

**Avantages** :
- ‚úÖ Edge Functions
- ‚úÖ Forms inclus
- ‚úÖ Split testing

**D√©ploiement** :

```bash
# 1. Installer Netlify CLI
npm i -g netlify-cli

# 2. Login
netlify login

# 3. Init
netlify init

# 4. D√©ployer
netlify deploy --prod

# 5. Configurer les variables
netlify env:set VITE_SUPABASE_URL "https://yaincoxihiqdksxgrsrk.supabase.co"
netlify env:set VITE_SUPABASE_ANON_KEY "eyJhbGciOi..."
```

**Configuration `netlify.toml`** :

```toml
[build]
  command = "npm run build"
  publish = "dist"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[build.environment]
  NODE_VERSION = "20"
```

---

#### Option C : Docker + Cloud (AWS, GCP, Azure)

**Dockerfile** (d√©j√† cr√©√©) :

```bash
# Build de l'image
docker build -t emotionscare:latest .

# Test local
docker run -p 3000:3000 emotionscare:latest

# Push sur Docker Hub
docker tag emotionscare:latest votre-org/emotionscare:latest
docker push votre-org/emotionscare:latest
```

**D√©ploiement AWS ECS** :

```bash
# 1. Cr√©er un cluster ECS
aws ecs create-cluster --cluster-name emotionscare-prod

# 2. Cr√©er une task definition
# task-definition.json d√©j√† cr√©√© dans le projet

# 3. D√©ployer
aws ecs run-task \
  --cluster emotionscare-prod \
  --task-definition emotionscare-task \
  --count 1
```

---

### ‚úÖ Phase 4 : Configuration Domaine (30 min)

#### 4.1 DNS

**Domaine** : `emotionscare.app` (exemple)

**Records DNS √† ajouter** :

```
# A Record (apex domain)
emotionscare.app        A       76.76.21.21 (IP Vercel/Netlify)

# CNAME (www)
www.emotionscare.app    CNAME   cname.vercel-dns.com

# TXT (v√©rification)
emotionscare.app        TXT     "vercel-verification=..."
```

**‚ö†Ô∏è Action** :
1. Aller sur votre registrar (OVH, Gandi, Cloudflare...)
2. Ajouter les records DNS
3. Attendre propagation (5-30 min)

---

#### 4.2 SSL/TLS

**Vercel/Netlify** : SSL automatique via Let's Encrypt ‚úÖ

**V√©rification** :
```bash
curl -I https://emotionscare.app
# ‚úÖ HTTP/2 200
# ‚úÖ strict-transport-security: max-age=31536000
```

---

### ‚úÖ Phase 5 : Monitoring & Analytics (1h)

#### 5.1 Sentry (Error Tracking)

**Installation** :

```bash
npm install @sentry/react @sentry/vite-plugin
```

**Configuration** :

```typescript
// src/lib/sentry.ts
import * as Sentry from "@sentry/react";

Sentry.init({
  dsn: "https://...@sentry.io/...",
  environment: import.meta.env.MODE,
  tracesSampleRate: 1.0,
  replaysSessionSampleRate: 0.1,
  replaysOnErrorSampleRate: 1.0,
});
```

**‚ö†Ô∏è Action** :
1. Cr√©er un projet sur [Sentry](https://sentry.io/)
2. Copier le DSN
3. Ajouter `VITE_SENTRY_DSN` dans les env variables

---

#### 5.2 Google Analytics 4

**Configuration** :

```typescript
// src/lib/analytics.ts
import ReactGA from "react-ga4";

ReactGA.initialize("G-XXXXXXXXXX");

export const trackPageView = (path: string) => {
  ReactGA.send({ hitType: "pageview", page: path });
};
```

**‚ö†Ô∏è Action** :
1. Cr√©er une propri√©t√© GA4 sur [Google Analytics](https://analytics.google.com/)
2. Copier le Measurement ID (G-...)
3. Ajouter `VITE_GA_TRACKING_ID` dans les env variables

---

#### 5.3 Supabase Analytics

**D√©j√† configur√©** ‚úÖ

**Tableaux de bord** :
- [Database Performance](https://supabase.com/dashboard/project/yaincoxihiqdksxgrsrk/reports/database)
- [API Usage](https://supabase.com/dashboard/project/yaincoxihiqdksxgrsrk/reports/api)
- [Auth Activity](https://supabase.com/dashboard/project/yaincoxihiqdksxgrsrk/reports/auth)

---

### ‚úÖ Phase 6 : S√©curit√© Production (30 min)

#### 6.1 Headers de s√©curit√©

**Vercel** (`vercel.json`) :

```json
{
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        },
        {
          "key": "Referrer-Policy",
          "value": "strict-origin-when-cross-origin"
        },
        {
          "key": "Permissions-Policy",
          "value": "camera=(), microphone=(), geolocation=()"
        }
      ]
    }
  ]
}
```

---

#### 6.2 Rate Limiting (Supabase)

**D√©j√† configur√©** ‚úÖ

**V√©rification** :
- Table `rate_limit_counters` existe
- Fonction `increment_rate_limit_counter()` active
- Policies RLS en place

---

#### 6.3 Backup Automatique

**Supabase** : Backups automatiques activ√©s ‚úÖ

**V√©rification** :
- [Database Backups](https://supabase.com/dashboard/project/yaincoxihiqdksxgrsrk/database/backups)
- R√©tention : 7 jours (gratuit) ou 30 jours (pro)

**‚ö†Ô∏è Action** : Passer au plan Pro pour backups 30 jours si besoin

---

### ‚úÖ Phase 7 : Tests Post-D√©ploiement (20 min)

#### 7.1 Smoke Tests

```bash
# V√©rifier que les pages principales chargent
curl -I https://emotionscare.app
curl -I https://emotionscare.app/login
curl -I https://emotionscare.app/register
curl -I https://emotionscare.app/dashboard

# ‚úÖ Toutes doivent retourner 200
```

---

#### 7.2 Tests Fonctionnels

**Checklist manuelle** :

- [ ] **Authentification**
  - [ ] Inscription email/password
  - [ ] Login email/password
  - [ ] Magic link
  - [ ] Logout
  - [ ] Mot de passe oubli√©

- [ ] **Dashboard**
  - [ ] Dashboard B2C charge
  - [ ] Dashboard B2B Collab charge
  - [ ] Dashboard RH charge

- [ ] **Fonctionnalit√©s**
  - [ ] Journal vocal (enregistrement + sauvegarde)
  - [ ] Journal texte (√©dition + sauvegarde)
  - [ ] VR Nebula (lancement + stats)
  - [ ] Coh√©rence cardiaque (exercice + historique)
  - [ ] √âvaluations (WHO-5, GAD-7, PSS-10, PHQ-9)

- [ ] **Performance**
  - [ ] FCP < 1.8s
  - [ ] LCP < 2.5s
  - [ ] CLS < 0.1

- [ ] **Accessibilit√©**
  - [ ] Navigation clavier (Tab, Enter, Esc)
  - [ ] Screen reader (NVDA, JAWS)
  - [ ] Contraste (min 4.5:1)

---

#### 7.3 Tests de Charge (optionnel)

**Tool** : k6 ou Artillery

```bash
# Installer k6
brew install k6

# Script de test
cat > load-test.js << 'EOF'
import http from 'k6/http';
import { check, sleep } from 'k6';

export const options = {
  vus: 100, // 100 utilisateurs simultan√©s
  duration: '5m',
};

export default function () {
  const res = http.get('https://emotionscare.app');
  check(res, { 'status was 200': (r) => r.status === 200 });
  sleep(1);
}
EOF

# Lancer le test
k6 run load-test.js
```

**R√©sultat attendu** :
- ‚úÖ 99% requests < 2s
- ‚úÖ 0% erreurs
- ‚úÖ Throughput > 50 req/s

---

## üéâ F√âLICITATIONS !

**EmotionsCare est maintenant en production** üöÄ

### üìä Tableau de bord de monitoring

**√Ä surveiller quotidiennement** :

| M√©trique | Outil | Cible | Alerte si |
|----------|-------|-------|-----------|
| **Uptime** | Vercel/Netlify | > 99.9% | < 99% |
| **FCP** | Google Analytics | < 1.8s | > 2.5s |
| **Error rate** | Sentry | < 0.1% | > 1% |
| **API usage** | Supabase | < 100k/jour | > 150k/jour |
| **Database size** | Supabase | < 500MB | > 800MB |

---

## üìÖ Planning Post-D√©ploiement

### Semaine 1 : Surveillance

- [ ] V√©rifier Sentry quotidiennement (erreurs)
- [ ] Monitorer Google Analytics (trafic, conversions)
- [ ] Analyser Supabase logs (requ√™tes lentes)
- [ ] Collecter feedback utilisateurs

### Semaine 2-4 : Optimisations

- [ ] Optimiser les requ√™tes lentes (index DB)
- [ ] Am√©liorer la couverture tests (cible 95%)
- [ ] Ajouter Storybook pour composants
- [ ] Compl√©ter composants unifi√©s (~80 restants)

### Mois 2-3 : √âvolution (Phase 2)

- [ ] Apps mobile natives (iOS + Android)
- [ ] Modules avanc√©s (coach IA, social, gamification)
- [ ] Int√©grations SIRH (ADP, Workday, SAP)
- [ ] SSO (Okta, Azure AD)

---

## üÜò Support & Ressources

### Documentation

- üìñ [Guide Utilisateur B2C](GUIDE_UTILISATEUR_B2C.md)
- üëî [Guide Collaborateur B2B](GUIDE_UTILISATEUR_B2B_COLLAB.md)
- üë®‚Äçüíº [Guide Admin RH](GUIDE_ADMIN_B2B_RH.md)
- ‚ùì [FAQ](FAQ_TROUBLESHOOTING.md)

### Liens Utiles

- üåê **Production** : https://emotionscare.app
- üìä **Supabase Dashboard** : https://supabase.com/dashboard/project/yaincoxihiqdksxgrsrk
- üîß **Vercel Dashboard** : https://vercel.com/votre-org/emotionscare
- üêõ **Sentry** : https://sentry.io/organizations/votre-org/projects/emotionscare
- üìà **Google Analytics** : https://analytics.google.com/

### Contact

- üìß **Support** : support@emotionscare.app
- üö® **Urgence** : support-urgent@emotionscare.app
- üîí **S√©curit√©** : security@emotionscare.app

---

**Bonne chance pour le lancement ! üéâüöÄ**

*Version : 1.0 - Janvier 2025*
