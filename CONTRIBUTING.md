# ü§ù Guide de Contribution - EmotionsCare

Merci de votre int√©r√™t pour contribuer √† EmotionsCare ! Ce guide vous aidera √† contribuer efficacement au projet.

## üìã Table des mati√®res

1. [Code de conduite](#code-de-conduite)
2. [Comment contribuer](#comment-contribuer)
3. [Configuration d√©veloppement](#configuration-d√©veloppement)
4. [Standards de code](#standards-de-code)
5. [Process de r√©vision](#process-de-r√©vision)
6. [Types de contributions](#types-de-contributions)

## üìú Code de conduite

En participant √† ce projet, vous acceptez de respecter notre [Code de Conduite](CODE_OF_CONDUCT.md).

### Principes fondamentaux :
- ‚ú® **Respect** : Soyez respectueux envers tous les contributeurs
- ü§ù **Collaboration** : Travaillez ensemble pour am√©liorer le projet
- üìö **Apprentissage** : Partagez vos connaissances et apprenez des autres
- üéØ **Qualit√©** : Maintenez des standards √©lev√©s de code et documentation

## üöÄ Comment contribuer

### 1. Fork et configuration
```bash
# Fork le repository sur GitHub puis :
git clone https://github.com/VOTRE_USERNAME/emotionscare-platform.git
cd emotionscare-platform

# Configuration upstream
git remote add upstream https://github.com/emotionscare/platform.git

# Installation
npm install
cp .env.example .env.local
# Configurer .env.local avec vos cl√©s
```

### 2. Cr√©er une branche
```bash
git checkout -b type/description-courte

# Exemples :
git checkout -b feature/ai-emotion-detection
git checkout -b fix/dashboard-loading-issue
git checkout -b docs/api-documentation
```

### 3. D√©velopper
- Suivez les [standards de code](#standards-de-code)
- Ajoutez des tests pour vos modifications
- V√©rifiez l'accessibilit√© (WCAG 2.1 AA)
- Testez localement :
  - `npm run lint`
  - `npm run test`
  - `npm run preview` (ou `npm run build` + `npm run preview`)

### 4. Commit
Utilisez le format [Conventional Commits](https://www.conventionalcommits.org/) :

```bash
git commit -m "type(scope): description"

# Types principaux :
feat:     # Nouvelle fonctionnalit√©
fix:      # Correction de bug
docs:     # Documentation
style:    # Formatage code (sans impact logique)
refactor: # Refactorisation
test:     # Ajout/modification tests
chore:    # Maintenance/outils
```

#### Exemples de commits :
```bash
feat(auth): ajoute authentification Google OAuth
fix(dashboard): corrige bug affichage donn√©es utilisateur
docs(readme): met √† jour instructions installation
test(components): ajoute tests Button component
refactor(hooks): simplifie logique useEmotionAnalysis
chore(deps): met √† jour d√©pendances s√©curit√©
```

### 5. Pull Request
```bash
git push origin votre-branche
```

Avant de cr√©er la PR, v√©rifiez :
- `npm run lint`
- `npm run test`
- `npm run preview`

Dans la PR GitHub :
- **Titre clair** : `type(scope): Description`
- **Description d√©taill√©e** : Que fait votre changement ? Pourquoi ?
- **Screenshots** : Pour les changements visuels
- **Tests** : R√©sum√© des commandes ex√©cut√©es (lint/test/preview)
- **Breaking changes** : Y a-t-il des changements cassants ?

## ‚öôÔ∏è Configuration d√©veloppement

### Pr√©requis
- Node.js 20+ et npm 10+
- Compte Supabase configur√©
- Cl√©s API (OpenAI, Hume) pour tests

### Environnement local
```bash
# Variables requises dans .env.local
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_anon_key
OPENAI_API_KEY=your_openai_key
HUME_API_KEY=your_hume_key
```

### Commandes utiles
```bash
npm run dev              # Serveur d√©veloppement
npm run test             # Tests unitaires
npm run test:e2e         # Tests end-to-end
npm run lint             # V√©rification code
npm run build            # Build production
npm run storybook        # Interface composants
npm run gen:openapi      # G√©n√©ration des types API depuis les specs
```

## üéØ Standards de code

### TypeScript
- **Mode strict** activ√©
- **Types explicites** pour exports publics
- **Pas de `any`** sauf cas exceptionnels document√©s
- **Interfaces** pr√©f√©r√©es aux types pour objets

### React
- **Composants fonctionnels** uniquement
- **Hooks** pour la logique state
- **Props typ√©es** avec TypeScript
- **Memo** pour optimisations si besoin

### Design system premium
- Utiliser les composants disponibles dans `src/ui` et les variables `tokens.css`.
- Chaque nouveau composant ou variation doit √™tre accompagn√© de stories (`Controls` + `A11y notes`).
- Pas de chiffres expos√©s dans les libell√©s UI ; privil√©gier des formulations descriptives (‚Äúambiance sereine‚Äù, ‚Äúguidage respiration douce‚Äù).
- Le focus visible doit utiliser `FocusRing` ou la classe `ec-focus-ring`.
- Respecter `prefers-reduced-motion` (animations neutralis√©es dans le design system).

### Modules & exports
- Chaque dossier applicatif dispose d'un `index.ts` (ou `index.tsx`) qui r√©-exporte l'API publique du domaine.
- Exposez les composants UI partag√©s dans `src/components/ui/**/*` **et** dans le registre global `src/COMPONENTS.reg.ts` (UI pur uniquement).
- Ex√©cutez `npm run generate:ui-registry` apr√®s toute modification du registre afin de mettre √† jour `docs/UI_COMPONENTS_REGISTRY.md`.
- Les barrels m√©tier (`index.ts`) ne doivent pas r√©-exporter de secrets (service-role, cl√©s) ni de stores priv√©s.

### Imports Node & bundling
- **Interdiction d'utiliser les imports `node:*`** c√¥t√© front : privil√©gier les APIs Web (`crypto.subtle`, `File`, `Blob`, etc.).
- Les scripts Node conservent l'import classique (`import fs from 'fs'`) pour compatibilit√© tooling.
- Tout import non tree-shak√© doit √™tre justifi√© dans la PR (bundle size).

#### üö´ Interdiction `node:*` c√¥t√© client (ECC-SEC-01)
- Tout fichier client sous `src/**` ne peut plus importer `node:*`. Le lint (`pnpm lint`) et la CI bloquent imm√©diatement si la r√®gle est viol√©e.
- Pr√©f√©rez les APIs Web : `crypto.subtle`, `fetch`, `FileReader`, `Blob`, `URL`, etc. Un utilitaire `sha256Hex` bas√© sur `crypto.subtle` est d√©j√† disponible dans `src/lib/hash.ts`.
- Les seuls dossiers autoris√©s √† utiliser `node:*` sont les services strictement serveur (`/services/**`) et les fonctions Supabase (`/supabase/functions/**`).

```ts
// ‚ùå Bloqu√© : crash en build/runtime c√¥t√© navigateur
import { createHash } from 'node:crypto';

// ‚úÖ Correct : API Web compatible bundle client
const encoder = new TextEncoder();
const data = encoder.encode(message);
const digest = await crypto.subtle.digest('SHA-256', data);
```

- Si vous avez besoin d'une fonctionnalit√© Node, cr√©ez un service c√¥t√© serveur (API, edge function) et exposez une API HTTP/Fetch pour le client.

### Stores Zustand & s√©lecteurs
- Centraliser les stores dans `src/store` et exposer des s√©lecteurs nomm√©s (`export const selectX = (state) => state.x`).
- √âviter d'acc√©der directement √† `useStore.getState()` dans les composants : pr√©f√©rer `useStore(selectX)` pour profiter de la comparaison par r√©f√©rence.
- Chaque ajout de logique store doit s'accompagner d'une suite de tests unitaires ciblant actions et s√©lecteurs.
- Pour les s√©lecteurs qui retournent plusieurs cl√©s ou des objets, utiliser `useAppStore(selector, shallow)` afin d'√©viter les rerenders inutiles.
- Les actions doivent rester pures et immuables : pas de mutation in-place ni d'effets secondaires implicites.
- Utiliser `subscribeWithSelector` pour les √©coutes sans rerender (analytics, logging) et garder `devtools` activ√© uniquement en d√©veloppement.
- Documenter toute nouvelle branche persist√©e et l'ajouter au `partialize` associ√© afin de conserver une hydratation minimale.

### Styling
- Les styles globaux sont centralis√©s dans `tokens.css` et `src/styles/ds-components.css`.
- Pas de `styled-components` ni de CSS-in-JS : utiliser les classes fournies par le design system.
- Toute exception locale doit rester purement utilitaire (pas de valeurs magiques). Documenter les raisons dans la PR.

### Terminologie & contenu UI
- Interdiction des termes cliniques explicites en UI (`d√©pression`, `diagnostic`, etc.) ‚Üí utiliser un vocabulaire bien-√™tre.
- Pas de scores chiffr√©s dans les pages B2C (scans, communaut√©, social). Pr√©f√©rer des messages qualitatifs.
- Respecter `docs/COMMUNITY_SAFETY.md`, `docs/SOCIAL_ROOMS.md`, `docs/VR_SAFETY.md` pour tout nouveau contenu sensible.

### Accessibilit√©
- **WCAG 2.1 AA** minimum requis
- **ARIA labels** appropri√©s
- **Navigation clavier** fonctionnelle
- **Contrastes** respect√©s
- **Screen readers** test√©s

### Tests
- **Coverage** > 80% pour nouveaux composants
- **Tests unitaires** avec Vitest + Testing Library
- **Tests E2E** avec Playwright pour workflows critiques
- **Tests a11y** avec axe-core

### Performance
- **Lazy loading** pour pages
- **Code splitting** appropri√©
- **Images optimis√©es** (WebP/AVIF)
- **Bundle size** monitoring

## üîç Process de r√©vision

### Checklist PR
Avant de soumettre, v√©rifiez :

#### ‚úÖ Code
- [ ] Code lint sans erreurs (`npm run lint`)
- [ ] Types TypeScript valides (`npm run type-check`)
- [ ] Types OpenAPI r√©g√©n√©r√©s (`npm run gen:openapi`)
- [ ] Tests passent (`npm run test`)
- [ ] Build r√©ussit (`npm run build`)

#### ‚úÖ Accessibilit√©
- [ ] Navigation clavier fonctionnelle
- [ ] ARIA labels appropri√©s
- [ ] Contrastes respect√©s
- [ ] Tests axe-core passent

#### ‚úÖ Documentation
- [ ] Code comment√© si logique complexe
- [ ] README mis √† jour si n√©cessaire
- [ ] CHANGELOG.md mis √† jour pour features/fixes

#### ‚úÖ Tests
- [ ] Tests unitaires pour nouvelle logique
- [ ] Tests E2E pour nouveaux workflows
- [ ] Edge cases consid√©r√©s

#### ‚úÖ Performance & QA
- [ ] `npm run preview` v√©rifi√© (no console error)
- [ ] Audit Lighthouse ou Web Vitals (si changement UI majeur)
- [ ] Axe-core / outils a11y pass√©s sur les pages modifi√©es
- [ ] Temps de chargement / bundle monitor√© (`npm run build` + analyse si besoin)

### R√©vision automatique
Notre CI v√©rifie automatiquement :
- ‚úÖ Linting et formatage
- ‚úÖ Tests unitaires et E2E
- ‚úÖ Build de production
- ‚úÖ Audits de s√©curit√©
- ‚úÖ Performance (Lighthouse)
- ‚úÖ Accessibilit√© (axe)

### R√©vision manuelle
L'√©quipe v√©rifie :
- üß† Logique m√©tier correcte
- üé® Coh√©rence UI/UX
- üì± Responsivit√© mobile
- üîí S√©curit√© et privacy
- üìö Qualit√© documentation

## üìù Types de contributions

### üêõ Bug fixes
1. **Reproduisez** le bug localement
2. **Cr√©ez un test** qui √©choue 
3. **Corrigez** le probl√®me
4. **V√©rifiez** que le test passe
5. **Documentez** la correction si n√©cessaire

### ‚ú® Nouvelles fonctionnalit√©s  
1. **Discutez** d'abord via Issue ou Discussion
2. **Concevez** l'interface et l'API
3. **Impl√©mentez** avec tests complets
4. **Documentez** utilisation et exemples
5. **Testez** accessibilit√© et performance

### üìö Documentation
- **README** : Instructions installation/usage
- **Code comments** : Logique complexe
- **Storybook** : Composants UI
- **Architecture docs** : D√©cisions techniques

### üß™ Tests
- **Tests manquants** : Ajoutez pour code existant
- **Tests E2E** : Workflows utilisateur critiques
- **Tests performance** : Benchmarks et optimisations

### üîß Outils et configuration
- **Scripts npm** : Am√©lioration workflow dev
- **CI/CD** : Optimisation pipeline
- **Linting** : Nouvelles r√®gles qualit√©
- **Monitoring** : Observabilit√© production

## üÜò Besoin d'aide ?

### O√π poser des questions
- üêõ **Bugs** : [GitHub Issues](../../issues)
- üí¨ **Questions g√©n√©rales** : [GitHub Discussions](../../discussions)  
- üí° **Id√©es de fonctionnalit√©s** : [GitHub Discussions](../../discussions)
- üìß **Contact direct** : contribute@emotionscare.dev

### Ressources utiles
- [Documentation technique](./docs/)
- [Guide d'architecture](./docs/ARCHITECTURE.md)
- [Configuration d√©veloppement](./docs/DEVELOPMENT_SETUP.md)
- [FAQ d√©veloppeurs](./docs/FAQ.md)

---

## üôè Remerciements

Merci √† tous nos contributeurs qui rendent EmotionsCare meilleur chaque jour !

[![Contributors](https://contrib.rocks/image?repo=emotionscare/platform)](https://github.com/emotionscare/platform/graphs/contributors)

Votre contribution, qu'elle soit code, documentation, tests ou feedback, est pr√©cieuse pour la communaut√© ! üíô